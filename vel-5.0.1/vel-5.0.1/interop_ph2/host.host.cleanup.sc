# cleanup scenario

# scenario
scenario interop {
    cleanup_REF1;
    cleanup_REF2;
    cleanup_TEST-TAR-HOST;
    cleanup_DUMPER;
}


# setup command
## REF1(REF1_NAME) runs as router
command cleanup_REF1 REF1 {

    execute "REF1_CMD_STOP_RTADVD";
    execute "REF1_CMD_RM_RTADVD_PID";

    execute "REF1_CMD_IFCONFIG_IF1_DOWN";
    execute "REF1_CMD_IFCONFIG_IF1_LLA_DELETE";
    execute "REF1_CMD_IFCONFIG_IF1_PREFIX1_GA_DELETE";
    execute "REF1_CMD_IFCONFIG_IF1_PREFIX1_ANY_DELETE";
    execute "REF1_CMD_IFCONFIG_IF1_MTU_1500";

    execute "REF1_CMD_IFCONFIG_IF2_DOWN";
    execute "REF1_CMD_IFCONFIG_IF2_LLA_DELETE";
    execute "REF1_CMD_IFCONFIG_IF2_PREFIX2_GA_DELETE";
    execute "REF1_CMD_IFCONFIG_IF2_PREFIX2_ANY_DELETE";
    execute "REF1_CMD_IFCONFIG_IF2_MTU_1500";

    execute "REF1_CMD_FLUSH_ROUTE_PREFIX3_IF1";
    execute "REF1_CMD_FLUSH_ROUTE_PREFIX3_IF2";
    execute "REF1_CMD_FLUSH_ROUTE_STATIC_PREFIX1";
    execute "REF1_CMD_FLUSH_ROUTE_STATIC_PREFIX2";
    execute "REF1_CMD_FLUSH_ROUTE_STATIC_PREFIX3";
    execute "REF1_CMD_FLUSH_PREFIX_LIST";

    execute "REF1_CMD_SYSCTL_NOT_ACCEPT_RA";
    execute "REF1_CMD_SYSCTL_NOT_FORWARDING";

    REF1_CMD_CLEAR_NCE_IF1;
    REF1_CMD_PRINT_NCE_IF1;
    REF1_CMD_CLEAR_NCE_IF2;
    REF1_CMD_PRINT_NCE_IF2;
}

## REF2(REF2_NAME) is disable
command cleanup_REF2 REF2 {

    execute "REF2_CMD_STOP_RTADVD";
    execute "REF2_CMD_RM_RTADVD_PID";

    execute "REF2_CMD_IFCONFIG_IF1_DOWN";
    execute "REF2_CMD_IFCONFIG_IF1_LLA_DELETE";
    execute "REF2_CMD_IFCONFIG_IF1_PREFIX2_GA_DELETE";
    execute "REF2_CMD_IFCONFIG_IF1_PREFIX2_ANY_DELETE";
    execute "REF2_CMD_IFCONFIG_IF1_MTU_1500";

    execute "REF2_CMD_IFCONFIG_IF2_DOWN";
    execute "REF2_CMD_IFCONFIG_IF2_LLA_DELETE";
    execute "REF2_CMD_IFCONFIG_IF2_PREFIX3_GA_DELETE";
    execute "REF2_CMD_IFCONFIG_IF2_PREFIX3_ANY_DELETE";
    execute "REF2_CMD_IFCONFIG_IF2_MTU_1500";

    execute "REF2_CMD_SYSCTL_NOT_ACCEPT_RA";
    execute "REF2_CMD_SYSCTL_NOT_FORWARDING";

    execute "REF2_CMD_FLUSH_ROUTE_PREFIX2_IF1";
    execute "REF2_CMD_FLUSH_ROUTE_PREFIX3_IF2";
    execute "REF2_CMD_FLUSH_ROUTE_STATIC_PREFIX1";
    execute "REF2_CMD_FLUSH_ROUTE_STATIC_PREFIX2";
    execute "REF2_CMD_FLUSH_ROUTE_STATIC_PREFIX3";
    execute "REF2_CMD_FLUSH_PREFIX_LIST";

    REF2_CMD_CLEAR_NCE_IF1;
    REF2_CMD_PRINT_NCE_IF1;
    REF2_CMD_CLEAR_NCE_IF2;
    REF2_CMD_PRINT_NCE_IF2;
}

## DUMPER(DUMPER_NAME)
command cleanup_DUMPER DUMPER {
    execute "killall tcpdump";
}

## TEST-TAR-HOST_TYPE(TEST-TAR-HOST_NAME)
command cleanup_TEST-TAR-HOST TEST-TAR-HOST {
    execute "TEST-TAR-HOST_CMD_STOP_RTADVD";
    execute "TEST-TAR-HOST_CMD_RM_RTADVD_PID";

    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF1_DOWN";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF1_LLA_DELETE";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF1_PREFIX1_GA_DELETE";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF1_MTU_1500";

    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF2_DOWN";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF2_LLA_DELETE";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF2_PREFIX2_GA_DELETE";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF2_MTU_1500";

    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF3_DOWN";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF3_LLA_DELETE";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF3_PREFIX3_GA_DELETE";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF3_MTU_1500";

    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF1_DELETE_LOGO_LLA";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF1_DELETE_DUP_ADDR";
    execute "TEST-TAR-HOST_CMD_IFCONFIG_IF1_PREFIX2_GA_DELETE";

    execute "TEST-TAR-HOST_CMD_FLUSH_ROUTE_PREFIX3_IF1";
    execute "TEST-TAR-HOST_CMD_FLUSH_ROUTE_PREFIX3_IF2";
    execute "TEST-TAR-HOST_CMD_FLUSH_ROUTE_LOGO";
    execute "TEST-TAR-HOST_CMD_FLUSH_ROUTE_REDIRECT";
    execute "TEST-TAR-HOST_CMD_FLUSH_ROUTE_STATIC_PREFIX1";
    execute "TEST-TAR-HOST_CMD_FLUSH_ROUTE_STATIC_PREFIX2";
    execute "TEST-TAR-HOST_CMD_FLUSH_ROUTE_STATIC_PREFIX3";
    execute "TEST-TAR-HOST_CMD_FLUSH_PREFIX_LIST";

    execute "TEST-TAR-HOST_CMD_SYSCTL_NOT_ACCEPT_RA";
    execute "TEST-TAR-HOST_CMD_SYSCTL_NOT_FORWARDING";

    TEST-TAR-HOST_CMD_CLEAR_NCE_IF1;
    TEST-TAR-HOST_CMD_PRINT_NCE_IF1;
    TEST-TAR-HOST_CMD_CLEAR_NCE_IF2;
    TEST-TAR-HOST_CMD_PRINT_NCE_IF2;
    TEST-TAR-HOST_CMD_CLEAR_NCE_IF3;
    TEST-TAR-HOST_CMD_PRINT_NCE_IF3;
}
